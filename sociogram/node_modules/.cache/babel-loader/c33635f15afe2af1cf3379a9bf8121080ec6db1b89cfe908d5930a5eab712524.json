{"ast":null,"code":"/*\n  autoindex.js - creates a directory autolisting for views which have missing index.html files\n*/\nvar layout = require('./layout');\nvar query = require('./query');\nmodule['exports'] = function autoindex(view, options, cb) {\n  if (typeof view !== \"object\" || typeof view.views !== \"object\") {\n    // TODO: should 404 error\n    // Remark: Based on current testing the following line may not ever be reached\n    return '404 - file not found -  cannot create autoindex';\n  }\n  var self = this;\n  var resp = Object.keys(view.views);\n  resp = resp.sort();\n  resp = resp.filter(function (item) {\n    // special case if the View has it's presenter exports.disabled set to true\n    // this will cause the page to not show in the autoindex\n    if (\n    // this case covers folders with index.js files\n    view.views[item].index && typeof view.views[item].index.presenter === \"function\" && view.views[item].index.presenter.disabled === true ||\n    // this case will cover normal views ( not folders of views )\n    typeof view.views[item].presenter === \"function\" && view.views[item].presenter.disabled === true) {\n      return false;\n    }\n    if (item !== \"layout\") {\n      return true;\n    }\n    return false;\n  });\n  var types = [];\n  var req = options.request,\n    res = options.response;\n  if (req.headers && req.headers.accept) {\n    types = req.headers.accept.split(',');\n  }\n  if (types.indexOf('text/html') === -1) {\n    resp = resp.map(function (item) {\n      return \"/\" + item;\n    });\n    return res.end(JSON.stringify(resp, true, 2));\n  }\n  var html = '<div class=\"container page\" role=\"main\">';\n  resp.forEach(function (v) {\n    html += '<a href=\"' + view.views[v].breadcrumb() + '\">' + v + '</a><br/>';\n  });\n  html += '</div>';\n  view.template = html;\n  layout.call(view, view, options, function (err, result) {\n    if (err) {\n      throw err;\n    }\n    var $ = query(result);\n    if ($('.yield').length === 0) {\n      cb(null, html);\n    } else {\n      $('.yield').html(html);\n      cb(null, $.html());\n    }\n  });\n};","map":{"version":3,"names":["layout","require","query","module","autoindex","view","options","cb","views","self","resp","Object","keys","sort","filter","item","index","presenter","disabled","types","req","request","res","response","headers","accept","split","indexOf","map","end","JSON","stringify","html","forEach","v","breadcrumb","template","call","err","result","$","length"],"sources":["/Users/ayanyadav/node_modules/view/lib/autoindex.js"],"sourcesContent":["/*\n  autoindex.js - creates a directory autolisting for views which have missing index.html files\n*/\nvar layout = require('./layout');\nvar query = require('./query');\n\nmodule['exports'] = function autoindex (view, options, cb) {\n  if (typeof view !== \"object\" || typeof view.views !== \"object\") {\n    // TODO: should 404 error\n    // Remark: Based on current testing the following line may not ever be reached\n    return '404 - file not found -  cannot create autoindex';\n  }\n  var self = this;\n  var resp = Object.keys(view.views);\n  resp = resp.sort();\n  resp = resp.filter(function(item){\n    // special case if the View has it's presenter exports.disabled set to true\n    // this will cause the page to not show in the autoindex\n    if ( // this case covers folders with index.js files\n        (view.views[item].index && typeof view.views[item].index.presenter === \"function\" && view.views[item].index.presenter.disabled === true)\n        ||\n        // this case will cover normal views ( not folders of views )\n        (typeof view.views[item].presenter === \"function\" && view.views[item].presenter.disabled === true)\n       ) {\n      return false;\n    }\n    if (item !== \"layout\") {\n      return true;\n    }\n    return false;\n  });\n\n  var types = [];\n  var req = options.request,\n      res = options.response;\n\n  if (req.headers && req.headers.accept) {\n    types = req.headers.accept.split(',');\n  }\n\n  if (types.indexOf('text/html') === -1) {\n    resp = resp.map(function(item){\n      return \"/\" + item;\n    });\n    return res.end(JSON.stringify(resp, true, 2));\n  }\n\n  var html = '<div class=\"container page\" role=\"main\">';\n  resp.forEach(function(v){\n    html += '<a href=\"' + view.views[v].breadcrumb() + '\">' + v + '</a><br/>';\n  });\n  html += '</div>';\n  view.template = html;\n  layout.call(view, view, options, function (err, result) {\n    if (err) {\n      throw err;\n    }\n    var $ = query(result);\n    if ($('.yield').length === 0) {\n      cb(null, html);\n    } else {\n      $('.yield').html(html);\n      cb(null, $.html());\n    }\n  });\n}"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}