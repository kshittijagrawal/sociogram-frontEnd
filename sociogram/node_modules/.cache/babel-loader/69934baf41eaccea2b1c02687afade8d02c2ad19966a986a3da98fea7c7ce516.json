{"ast":null,"code":"var path = require('path'),\n  fs = require('fs');\nvar query = require('./query'),\n  layout = require('./layout'),\n  render = require('./render');\nvar View = function (options) {\n  var self = this;\n  options = options || {};\n  self.viewPath = options.path || process.cwd();\n  if (options.path) {\n    self.viewPath = options.path;\n    self.templatePath = self.viewPath + '/';\n    self.presenterPath = self.viewPath + '/';\n  }\n  if (options.autoindex === true) {\n    self.autoindex = true;\n  }\n  self.ext = options.ext || \".html\";\n  if (options.remote) {\n    self._remote = options.remote;\n  }\n  if (options.name) {\n    self.name = options.name;\n  } else {\n    self.name = \"\";\n  }\n  if (options.key) {\n    if (options.key === \"/\") {\n      self.key = options.key + self.name;\n    } else {\n      self.key = options.key + \"/\" + self.name;\n    }\n  } else {\n    self.key = \"/\";\n  }\n  if (options.template) {\n    self.template = options.template;\n    //\n    // Remark: If we have been passed in a template as a string, the querySelectorAll context needs to be updated\n    //\n    self.$ = query(self.template);\n  }\n  if (options.presenter) {\n    self.presenter = options.presenter;\n  }\n  if (options.parent) {\n    self.parent = options.parent;\n  }\n  if (typeof options === \"string\") {\n    this.load(options);\n  }\n  return this;\n};\n\n//\n// Loads a view from remote HTTP source\n//\nView.prototype.remote = require('./remote');\n\n//\n// Loads a template file or directory by path\n//\nView.prototype.load = function (viewPath, cb) {\n  var self = this;\n  if (typeof cb !== 'function' && typeof viewPath === 'function') {\n    cb = viewPath;\n  }\n  if (self._remote) {\n    return self.remote(viewPath, cb);\n  }\n  if (typeof viewPath === \"string\") {\n    self.viewPath = viewPath;\n  }\n  self.templatePath = self.viewPath + '/';\n  self.presenterPath = self.viewPath + '/';\n  if (typeof cb !== 'function') {\n    throw new Error(\"callback is required\");\n  }\n  return self._loadAsync(cb);\n};\nView.prototype._loadAsync = function (cb) {\n  var self = this,\n    viewPath = self.viewPath,\n    callbacks = 0;\n  var root = self.viewPath;\n  fs.readdir(root, function (err, dir) {\n    if (err) {\n      return cb(err);\n    }\n    dir = dir.filter(function (item) {\n      // TODO: move ignored files to JSON configuration option\n      if (['.DS_Store'].indexOf(item) === -1) {\n        return true;\n      }\n      return false;\n    });\n    // Do not attempt to process empty directories\n    if (dir.length === 0) {\n      return cb(null, self);\n    }\n    dir.forEach(function (p) {\n      fs.stat(root + '/' + p, function (err, stat) {\n        if (stat.isDirectory()) {\n          delegate('dir', p);\n        } else {\n          delegate('file', p);\n        }\n      });\n    });\n  });\n  function delegate(type, _path) {\n    var ext = self.detect(_path),\n      subViewName;\n    subViewName = _path;\n    if (type === \"file\") {\n      subViewName = _path.replace(ext, '');\n      if (subViewName === \".DS_Store\") {\n        return;\n      }\n      //\n      // increase the callback count\n      //\n      callbacks++;\n\n      // TODO: refactor this method a bit with js presenter loading code\n      function createView(presenter, template) {\n        //\n        // load the file as the current template\n        //\n        fs.readFile(root + '/' + _path, function (err, result) {\n          if (err) {\n            throw err;\n          }\n          result = result.toString();\n          var presenter, template;\n          //\n          // determine if file is template or presenter\n          //\n          template = result;\n          if (typeof self[subViewName] === \"object\") {\n            self[subViewName].template = template;\n            self.views[subViewName].template = template;\n          } else {\n            // console.log('self._root1', self._root);\n            self[subViewName] = new View({\n              name: subViewName,\n              ext: ext,\n              template: template,\n              parent: self\n            });\n\n            // Remark: added additional scope to help iterate through nested views\n            // without this additional views scope, we don't know whats a property or nested view\n            self.views = self.views || {};\n            //console.log('self._root2', self._root)\n            self.views[subViewName] = new View({\n              name: subViewName,\n              ext: ext,\n              template: template,\n              parent: self\n            });\n          }\n          callbacks--;\n          if (callbacks === 0) {\n            cb(null, self);\n          }\n        });\n      }\n\n      // determine if file is template or presenter ( presenters end in .js and are node modules )\n      if (ext === \".js\") {\n        // if we found a .js file, assume its a presenter\n        // check if a view already exists at this level with this name, if so attach this as presenter\n\n        //\n        // get presenter, if it exists\n        //\n        var presenterPath = root + '/' + _path.replace(ext, '.js');\n\n        //\n        // Determine if presenter file exists first before attempting to require it\n        //\n        // TODO: replace with async stat\n        var exists = false;\n        try {\n          var stat = fs.statSync(presenterPath);\n          exists = true;\n        } catch (err) {\n          exists = false;\n        }\n        if (exists) {\n          delete require.cache[presenterPath];\n          require.cache[presenterPath] = null;\n          var resolved = path.resolve(presenterPath);\n          delete require.cache[resolved];\n          require.cache[resolved] = null;\n          presenter = require(resolved);\n        }\n        if (typeof self[subViewName] === \"object\") {\n          self[subViewName].presenter = presenter;\n          self.views[subViewName].presenter = presenter;\n        } else {\n          self[subViewName] = new View({\n            name: subViewName,\n            ext: ext,\n            //template: template,\n            presenter: presenter,\n            key: self.key,\n            parent: self\n          });\n          // Remark: added additional scope to help iterate through nested views\n          // without this additional views scope, we don't know whats a property or nested view\n          self.views = self.views || {};\n          //console.log('self._root3', self._root, self.key);\n          self.views[subViewName] = new View({\n            name: subViewName,\n            ext: ext,\n            key: self.key,\n            //template: template,\n            presenter: presenter,\n            parent: self\n          });\n        }\n        callbacks--;\n        setTimeout(function () {\n          if (callbacks === 0) {\n            cb(null, self);\n          }\n        }, 1);\n      } else {\n        // if we found a non .js file, assume it's a template\n        // check if a view already exists at this level with this name, if so attach this as template\n        createView();\n      }\n    }\n    if (type === \"dir\") {\n      //\n      // create a new subview\n      //\n      self.views = self.views || {};\n      //console.log('self._root4', self._root)\n\n      self.views[subViewName] = self[subViewName] = new View({\n        name: subViewName,\n        ext: ext,\n        key: self.key,\n        path: root + '/' + _path,\n        parent: self\n      });\n      //\n      // increase callback count\n      //\n      callbacks++;\n      //\n      // load view\n      //\n      self[subViewName].load(function () {\n        //\n        // decrease callback count\n        //\n        callbacks--;\n        if (callbacks === 0) {\n          cb(null, self);\n        }\n      });\n    }\n  }\n  return;\n};\nView.prototype.present = function (options, callback) {\n  var self = this,\n    useLayout = false,\n    saveToCache = false;\n  var _template = self.template;\n  if (options.base) {\n    //self = options.base;\n  }\n  if (options.template) {\n    //_template = options.template;\n  }\n  if (options.layout) {\n    //self.layout = options.layout;\n  }\n\n  // console.log('presenting', self.presenter.cache, self.lastCache, self._cache);\n  self.schema = {};\n  if (self.presenter && self.presenter.schema) {\n    self.schema = self.presenter.schema;\n  }\n  if (self.presenter && typeof self.presenter.cache !== 'undefined' && typeof self.presenter.cache === \"number\") {\n    // the presenter has indicated it should be cached. check to see if a version is already stored\n    if (typeof self.lastCache === 'undefined') {\n      // no cache has been found, as a cache is required. run the view and save to cache\n      saveToCache = true;\n      // console.log('first time, creating new cache');\n    } else {\n      // a cache has been found. check to see if it's expired. if not expired, serve.\n      var now = new Date().getTime();\n      var diff = now - self.lastCache;\n      if (self.presenter.cache === 0) {\n        // a cache value of 0 indicates the cache never expires, return from cache\n        return callback(null, self._cache);\n      }\n      if (diff >= self.presenter.cache) {\n        saveToCache = true;\n        // console.log('cache found, but expired by ', (diff - self.presenter.cache));\n      } else {\n        // console.log('cache found, serving');\n        return callback(null, self._cache);\n      }\n    }\n  }\n  if (typeof options.useLayout === 'undefined' || options.useLayout === true) {\n    useLayout = true;\n  }\n\n  // if this is not a layout, do perform layout\n  if (self.name !== \"layout\") {\n    // load query\n    // TODO: better template rendering support\n    var ren = _template;\n    if (self.ext === \".markdown\") {\n      self.template = require('./engines/markdown')(self.template);\n    }\n    self.$ = query(_template);\n    var overrideLayout = false;\n    if (typeof self.presenter === \"function\" && self.presenter.useLayout === false) {\n      overrideLayout = true;\n    }\n    //console.log('layout? ', useLayout, overrideLayout)\n    if (useLayout && !overrideLayout) {\n      layout.call(self, self, options, function (err, result) {\n        if (err) {\n          throw err;\n        }\n        // update template and reload query\n        self.$ = query(result);\n        var _presenter = render;\n        if (typeof self.presenter === \"function\") {\n          _presenter = self.presenter;\n        } else if (typeof _template === \"undefined\") {\n          var e = new Error(\"No presenter found!\");\n          e.code = \"NO_PRESENTER_FOUND\";\n          return callback(e);\n        }\n\n        // if we have presenter, use it,\n        // otherwise fallback to default presenter\n        return _presenter.call(self, options, function (err, result) {\n          if (err === null) {\n            if (saveToCache) {\n              self.lastCache = new Date().getTime();\n              self._cache = result;\n            }\n          }\n          callback(err, result);\n        });\n      });\n    } else {\n      // if we have presenter, use it,\n      // otherwise fallback to default presenter\n      return (self.presenter || render).call(self, options, function (err, result) {\n        if (err === null) {\n          if (saveToCache) {\n            self.lastCache = new Date().getTime();\n            self._cache = result;\n          }\n        }\n        callback(err, result);\n      });\n    }\n  } else {\n    // load query\n    self.$ = query(self.template);\n\n    // if we have presenter, use it,\n    // otherwise fallback to default presenter\n\n    var _presenter = render;\n    if (typeof self.presenter === \"function\") {\n      _presenter = self.presenter;\n    }\n    return _presenter.call(self, options, function (err, result) {\n      if (saveToCache) {\n        self.lastCache = new Date().getTime();\n        self._cache = result;\n      }\n      return callback(err, result);\n    });\n  }\n};\n\n//\n// TODO: Detects view type based on current path\n//\nView.prototype.detect = function (p) {\n  return path.extname(p);\n};\nView.prototype.breadcrumb = function () {\n  if (typeof this.parent === \"undefined\") {\n    return this.name;\n  }\n  return this.parent.breadcrumb() + '/' + this.name;\n};\nmodule['exports'] = View;","map":{"version":3,"names":["path","require","fs","query","layout","render","View","options","self","viewPath","process","cwd","templatePath","presenterPath","autoindex","ext","remote","_remote","name","key","template","$","presenter","parent","load","prototype","cb","Error","_loadAsync","callbacks","root","readdir","err","dir","filter","item","indexOf","length","forEach","p","stat","isDirectory","delegate","type","_path","detect","subViewName","replace","createView","readFile","result","toString","views","exists","statSync","cache","resolved","resolve","setTimeout","present","callback","useLayout","saveToCache","_template","base","schema","lastCache","now","Date","getTime","diff","_cache","ren","overrideLayout","call","_presenter","e","code","extname","breadcrumb","module"],"sources":["/Users/ayanyadav/node_modules/view/lib/View.js"],"sourcesContent":["var path = require('path'),\n    fs = require('fs');\nvar query = require('./query'),\n    layout = require('./layout'),\n    render = require('./render');\n\nvar View = function (options) {\n  var self = this;\n\n  options = options || {};\n  self.viewPath = options.path || process.cwd();\n\n  if (options.path) {\n    self.viewPath      = options.path;\n    self.templatePath  = self.viewPath + '/';\n    self.presenterPath = self.viewPath + '/';\n  }\n\n  if (options.autoindex === true) {\n    self.autoindex = true;\n  }\n\n  self.ext = options.ext || \".html\";\n\n  if (options.remote) {\n    self._remote = options.remote;\n  }\n\n  if (options.name) {\n    self.name = options.name;\n  } else {\n    self.name = \"\";\n  }\n\n  if (options.key) {\n    if(options.key === \"/\") {\n      self.key = options.key + self.name;\n    } else {\n      self.key = options.key + \"/\" + self.name;\n    }\n  } else {\n    self.key = \"/\";\n  }\n\n  if (options.template) {\n    self.template = options.template;\n    //\n    // Remark: If we have been passed in a template as a string, the querySelectorAll context needs to be updated\n    //\n    self.$ = query(self.template);\n  }\n\n  if (options.presenter) {\n    self.presenter = options.presenter;\n  }\n\n  if (options.parent) {\n    self.parent = options.parent;\n  }\n\n  if (typeof options === \"string\") {\n    this.load(options);\n  }\n\n  return this;\n};\n\n//\n// Loads a view from remote HTTP source\n//\nView.prototype.remote = require('./remote');\n\n//\n// Loads a template file or directory by path\n//\nView.prototype.load = function (viewPath, cb) {\n  var self = this;\n\n  if(typeof cb !== 'function' && typeof viewPath === 'function') {\n    cb = viewPath;\n  }\n\n  if (self._remote) {\n    return self.remote(viewPath, cb);\n  }\n\n  if(typeof viewPath === \"string\") {\n    self.viewPath = viewPath;\n  }\n\n  self.templatePath  = self.viewPath + '/';\n  self.presenterPath = self.viewPath + '/';\n\n  if (typeof cb !== 'function') {\n    throw new Error(\"callback is required\");\n  }\n  return self._loadAsync(cb);\n};\n\nView.prototype._loadAsync = function (cb) {\n  var self = this,\n  viewPath = self.viewPath,\n  callbacks = 0;\n\n  var root = self.viewPath;\n\n  fs.readdir(root, function(err, dir) {\n    if (err) {\n      return cb(err);\n    }\n    dir = dir.filter(function(item){\n      // TODO: move ignored files to JSON configuration option\n      if (['.DS_Store'].indexOf(item) === -1) {\n        return true;\n      }\n      return false;\n    });\n    // Do not attempt to process empty directories\n    if (dir.length === 0) {\n      return cb(null, self);\n    }\n    dir.forEach(function(p) {\n      fs.stat(root + '/' + p, function(err, stat) {\n        if (stat.isDirectory()){\n          delegate('dir', p);\n        } else {\n          delegate('file', p);\n        }\n      });\n    });\n   });\n\n  function delegate (type, _path) {\n    var ext = self.detect(_path),\n        subViewName;\n\n    subViewName = _path;\n\n    if (type === \"file\") {\n\n      subViewName = _path.replace(ext, '');\n      if (subViewName === \".DS_Store\") {\n        return;\n      }\n      //\n      // increase the callback count\n      //\n      callbacks++;\n\n      // TODO: refactor this method a bit with js presenter loading code\n      function createView (presenter, template) {\n        //\n        // load the file as the current template\n        //\n        fs.readFile(root + '/' + _path, function (err, result) {\n\n          if (err) {\n            throw err;\n          }\n          result = result.toString();\n          var presenter, template;\n          //\n          // determine if file is template or presenter\n          //\n          template = result;\n\n          if (typeof self[subViewName] === \"object\") {\n            self[subViewName].template = template;\n            self.views[subViewName].template = template;\n          } else {\n            // console.log('self._root1', self._root);\n            self[subViewName] = new View({\n              name: subViewName,\n              ext: ext,\n              template: template,\n              parent: self\n            });\n\n            // Remark: added additional scope to help iterate through nested views\n            // without this additional views scope, we don't know whats a property or nested view\n            self.views = self.views || {};\n            //console.log('self._root2', self._root)\n            self.views[subViewName] = new View({\n              name: subViewName,\n              ext: ext,\n              template: template,\n              parent: self\n            });\n\n          }\n\n          callbacks--;\n          if (callbacks === 0) {\n            cb(null, self);\n          }\n        });\n      }\n\n      // determine if file is template or presenter ( presenters end in .js and are node modules )\n      if (ext === \".js\") {\n\n        // if we found a .js file, assume its a presenter\n        // check if a view already exists at this level with this name, if so attach this as presenter\n\n        //\n        // get presenter, if it exists\n        //\n        var presenterPath = root +  '/' + _path.replace(ext, '.js');\n\n        //\n        // Determine if presenter file exists first before attempting to require it\n        //\n        // TODO: replace with async stat\n        var exists = false;\n        try {\n          var stat = fs.statSync(presenterPath);\n          exists = true;\n        } catch (err) {\n          exists = false;\n        }\n\n        if (exists) {\n          delete require.cache[presenterPath];\n          require.cache[presenterPath] = null;\n          var resolved = path.resolve(presenterPath);\n          delete require.cache[resolved];\n          require.cache[resolved] = null;\n          presenter = require(resolved);\n        }\n\n        if (typeof self[subViewName] === \"object\") {\n          self[subViewName].presenter = presenter;\n          self.views[subViewName].presenter = presenter;\n        } else {\n          self[subViewName] = new View({\n            name: subViewName,\n            ext: ext,\n            //template: template,\n            presenter: presenter,\n            key: self.key,\n            parent: self\n          });\n          // Remark: added additional scope to help iterate through nested views\n          // without this additional views scope, we don't know whats a property or nested view\n          self.views = self.views || {};\n          //console.log('self._root3', self._root, self.key);\n          self.views[subViewName] = new View({\n            name: subViewName,\n            ext: ext,\n            key: self.key,\n            //template: template,\n            presenter: presenter,\n            parent: self\n          });\n        }\n        callbacks--;\n        setTimeout(function(){\n          if (callbacks === 0) {\n            cb(null, self);\n          }\n        }, 1);\n      } else {\n        // if we found a non .js file, assume it's a template\n        // check if a view already exists at this level with this name, if so attach this as template\n        createView();\n      }\n    }\n\n    if (type === \"dir\") {\n      //\n      // create a new subview\n      //\n      self.views = self.views || {};\n      //console.log('self._root4', self._root)\n\n      self.views[subViewName] = self[subViewName] = new View({\n        name: subViewName,\n        ext: ext,\n        key: self.key,\n        path: root + '/' + _path,\n        parent: self\n      });\n      //\n      // increase callback count\n      //\n      callbacks ++;\n      //\n      // load view\n      //\n      self[subViewName].load(function() {\n        //\n        // decrease callback count\n        //\n        callbacks--;\n        if(callbacks === 0){\n          cb(null, self);\n        }\n      });\n    }\n  }\n  return;\n\n};\n\nView.prototype.present = function (options, callback) {\n\n  var self = this, useLayout = false, saveToCache = false;\n  var _template = self.template;\n\n  if (options.base) {\n    //self = options.base;\n  }\n\n  if (options.template) {\n    //_template = options.template;\n  }\n\n  if (options.layout) {\n    //self.layout = options.layout;\n  }\n\n  // console.log('presenting', self.presenter.cache, self.lastCache, self._cache);\n  self.schema = {};\n  if (self.presenter && self.presenter.schema) {\n    self.schema = self.presenter.schema;\n  }\n  if (self.presenter && typeof self.presenter.cache !== 'undefined' && typeof self.presenter.cache === \"number\") {\n    // the presenter has indicated it should be cached. check to see if a version is already stored\n    if (typeof self.lastCache === 'undefined') {\n      // no cache has been found, as a cache is required. run the view and save to cache\n      saveToCache = true;\n      // console.log('first time, creating new cache');\n    } else {\n      // a cache has been found. check to see if it's expired. if not expired, serve.\n      var now = new Date().getTime();\n      var diff = (now - self.lastCache);\n      if (self.presenter.cache === 0) {\n        // a cache value of 0 indicates the cache never expires, return from cache\n        return callback(null, self._cache);\n      }\n      if (diff >= self.presenter.cache) {\n        saveToCache = true;\n        // console.log('cache found, but expired by ', (diff - self.presenter.cache));\n      } else {\n        // console.log('cache found, serving');\n        return callback(null, self._cache);\n      }\n    }\n  }\n\n  if (typeof options.useLayout === 'undefined' || options.useLayout === true) {\n    useLayout = true;\n  }\n\n  // if this is not a layout, do perform layout\n  if (self.name !== \"layout\") {\n    // load query\n    // TODO: better template rendering support\n    var ren = _template;\n    if (self.ext === \".markdown\") {\n      self.template = require('./engines/markdown')(self.template);\n    }\n    self.$ = query(_template);\n\n    var overrideLayout = false;\n\n    if (typeof self.presenter === \"function\" && self.presenter.useLayout === false) {\n      overrideLayout = true;\n    }\n    //console.log('layout? ', useLayout, overrideLayout)\n    if (useLayout && !overrideLayout) {\n\n      layout.call(self, self, options, function (err, result) {\n        if (err) {\n          throw err;\n        }\n        // update template and reload query\n        self.$ = query(result);\n\n        var _presenter = render;\n        if (typeof self.presenter === \"function\" ) {\n          _presenter = self.presenter;\n        } else if (typeof _template === \"undefined\") {\n          var e = new Error(\"No presenter found!\");\n          e.code = \"NO_PRESENTER_FOUND\";\n          return callback(e);\n        }\n\n        // if we have presenter, use it,\n        // otherwise fallback to default presenter\n        return _presenter.call(self, options, function (err, result){\n          if (err === null) {\n            if (saveToCache) {\n              self.lastCache = new Date().getTime();\n              self._cache = result;\n            }\n          }\n          callback(err, result);\n        });\n      });\n    } else {\n      // if we have presenter, use it,\n      // otherwise fallback to default presenter\n      return (self.presenter || render).call(self, options, function (err, result){\n        if (err === null) {\n          if (saveToCache) {\n            self.lastCache = new Date().getTime();\n            self._cache = result;\n          }\n        }\n        callback(err, result);\n      });\n    }\n  } else {\n    // load query\n    self.$ = query(self.template);\n\n    // if we have presenter, use it,\n    // otherwise fallback to default presenter\n\n    var _presenter = render;\n    if (typeof self.presenter === \"function\" ) {\n      _presenter = self.presenter;\n    }\n\n    return _presenter.call(self, options, function(err, result) {\n      if (saveToCache) {\n        self.lastCache = new Date().getTime();\n        self._cache = result;\n      }\n      return callback(err, result);\n    });\n  }\n};\n\n//\n// TODO: Detects view type based on current path\n//\nView.prototype.detect = function (p) {\n  return path.extname(p);\n};\n\nView.prototype.breadcrumb = function () {\n  if (typeof this.parent === \"undefined\") {\n    return this.name;\n  }\n  return this.parent.breadcrumb() + '/' + this.name;\n};\n\nmodule['exports'] = View;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}